"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var react=require("react"),__assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function __spreadArrays(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var u=arguments[t],o=0,i=u.length;o<i;o++,a++)r[a]=u[o];return r}var domChangeTimeout,queryableKeys={meta:["charset","name","property","http-equiv"],link:["rel","sizes"]},createInternalTag=function(e){return function(t){var n=queryableKeys[e].map((function(e){return t.hasOwnProperty(e)?{key:e,value:t[e]}:void 0})).filter(Boolean),r=Object.keys(t).map((function(e){return{key:e,value:t[e]}}));return{tag:e,query:n.length?n:r,attributes:t}}},createInternalMeta=createInternalTag("meta"),createInternalLink=createInternalTag("link"),parseMetaConfig=function(e){var t=e.title,n=e.description,r=e.lang,a=e.charset,u=e.metas,o=void 0===u?[]:u,i=e.links,s=void 0===i?[]:i,c=e.openGraph,g=void 0===c?{}:c,m=e.twitter,l=void 0===m?{}:m;return{title:t,lang:r,tags:__spreadArrays([!!n&&{tag:"meta",query:[{key:"name",value:"description"}],attributes:{name:"description",content:n}},!!a&&{tag:"meta",query:[{key:"charset"}],attributes:{charset:a}}],o.map(createInternalMeta),s.map(createInternalLink),Object.keys(g).map((function(e){return createInternalMeta({property:"og:"+e,content:g[e]})})),Object.keys(l).map((function(e){return createInternalMeta({property:"twitter:"+e,content:l[e]})}))).filter((function(e){return e&&e.query&&Object.keys(e.query).length})).reduce((function(e,t){var n,r=t.query.map((function(e){var t=e.key,n=void 0===t?"":t,r=e.value;return n+"="+(void 0===r?"":r)})).join("~"),a=t.tag+"_"+r;return __assign(__assign({},e),((n={})[a]=t,n))}),{})}},metaStore=new Set,subscribers=new Set,mergeInstanceConfigs=function(e){return Array.from(e).map((function(e){return e.current})).reduce((function(e,t){return __assign(__assign(__assign({},e),t),{tags:__assign(__assign({},e.tags),t.tags)})}),{tags:{}})},emitChanges=function(e){subscribers.forEach((function(t){return t(e)}))},addMetasToStore=function(e){!metaStore.has(e)&&metaStore.add(e),emitChanges(mergeInstanceConfigs(metaStore))},removeMetasFromStore=function(e){metaStore.delete(e),emitChanges(mergeInstanceConfigs(metaStore))},subscribeToStore=function(e){return subscribers.add(e),function(){subscribers.delete(e)}},getState=function(){return mergeInstanceConfigs(metaStore)},getRemovedTags=function(e,t){return Object.keys(t.tags||{}).filter((function(t){return!e.tags[t]})).map((function(e){return t.tags[e]}))},getTagsList=function(e){return Object.keys(e.tags||{}).map((function(t){return e.tags[t]}))},getHeadElement=function(e,t){var n=t.reduce((function(e,t){var n=t.key,r=t.value;return e+"["+n+(r?'="'+r+'"':"")+"]"}),"");return document.head.querySelector(e+n)},createHeadElement=function(e){var t=document.createElement(e);return document.head.appendChild(t),t},setTitle=function(e){document.title=e},setLang=function(e){document.documentElement.lang=e},setHeadElement=function(e){var t=e.tag,n=e.query,r=e.attributes,a=getHeadElement(t,n)||createHeadElement(t);r&&Object.keys(r).forEach((function(e){a.setAttribute(e,r[e]||"")}))},removeHeadElement=function(e){var t=e.tag,n=e.query,r=getHeadElement(t,n);r&&document.head.removeChild(r)},lastMetas={tags:{}},updateDom=function(e,t){"undefined"!=typeof window&&(window.clearTimeout(domChangeTimeout),domChangeTimeout=setTimeout((function(){var t=getRemovedTags(e,lastMetas),n=getTagsList(e);lastMetas=e,e.title&&setTitle(e.title),e.lang&&setLang(e.lang),n.forEach(setHeadElement),t.forEach(removeHeadElement)}),t))},generateMetasMarkup=function(e){return __spreadArrays([e.title?"<title>"+e.title+"</title>":""],getTagsList(e).map((function(e){var t=e.attributes;return"<"+e.tag+" "+Object.keys(t).map((function(e){return""+e+(t[e]?'="'+t[e]+'"':"")})).join(" ")+" />"}))).join("")};subscribeToStore((function(e){return updateDom(e,50)}));var generateStaticHtml=function(){var e=getState();return generateMetasMarkup(e)},useMetaTags=function(e,t){var n=react.useRef(),r=react.useMemo((function(){return parseMetaConfig(e)}),t);react.useEffect((function(){return function(){n.current&&removeMetasFromStore(n)}}),[]),n.current!==r&&(n.current=r,n.current&&addMetasToStore(n))};exports.default=useMetaTags,exports.generateStaticHtml=generateStaticHtml;
//# sourceMappingURL=index.cjs.js.map
